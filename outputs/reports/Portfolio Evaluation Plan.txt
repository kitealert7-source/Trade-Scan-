Portfolio Evaluation Plan (IDX22)
Goal: Evaluate IDX22 as a multi-instrument portfolio and archive a frozen snapshot.

1. Tool Creation (tools/portfolio_evaluator.py)
Input: Strategy ID (e.g., IDX22).
Data Loading:
Scan backtests/{StrategyID}_*/raw/results_tradelevel.csv.
Normalize columns (Exit Time, PnL).
Align to daily timeframe (resample if needed for correlation).
Portfolio Construction (Chronological):
Method: "Closed Trade Equity" model.
Disclaimer: Ignores open trade MTM (underestimates intra-period DD).
Events: Trade Close Dates.
Sort all trades globally by exit_time.
Current Equity = Total Initial Capital + Cumulative Sum of PnL.
Total Capital: $5,000 × N_Symbols. (e.g., $5,000 × 10 = $50,000).
Analytics Modules:
Correlation:
Input: Daily Returns (pct_change of daily equity).
Alignment: Common Calendar (fill missing days with 0 return).
Window: 60 trading days.
Output: Rolling Matrix & Average.
Capital Efficiency:
Avg Concurrent Exposure (Active trades count).
% Idle Capital.
Return per Active Day.
Concentration (Risk):
Herfindahl-Hirschman Index (HHI) on PnL contribution.
Flag if Top 2 > 60%.
Fragility Indicator:
Drawdown Compression Ratio: Max Portfolio DD / Worst Single Symbol DD (same capital basis).
Flag if > 1.5.
Recovery Efficiency: Total Net PnL / Max DD Duration (calendar days).
Drawdown:
Duration: Calendar days (peak to recovery). Also count trades.
Stress Test (Clusters):
US: NAS100, SPX500, US30.
EU: GER40, FRA40, EUSTX50, ESP35.
Asia: JPN225, AUS200.
Report Deltas: Net PnL, Sharpe, Max DD, Return/DD, Compression Ratio, HHI, Verdict.
Governance:
Calculate SHA256 hash of all input trade files.
Store explicit metadata in portfolio_summary.json (Strategy ID, Engine Version, Data Range, Capital, Hash).
Promotion Thresholds (Deterministic):
Sharpe ≥ 1.1 (Conditional: 1.05 - 1.10)
Max DD ≤ 8% (Conditional: 8% - 9%)
HHI ≤ 0.30 (Conditional: 0.30 - 0.35)
Compression Ratio ≤ 1.5 (Conditional: 1.5 - 1.7)
Top 2 Contribution ≤ 60% (Conditional: 60% - 65%)
Safety Check: If TotalPnL ≤ 0 → FAIL.
Verdict Logic:
PASS: All thresholds met.
CONDITIONAL: 1 threshold in conditional range.
FAIL: >1 breached OR Sharpe < 1.0.
Visualization:
Equity Curve (PnL accumulation).
Drawdown Curve (% off peak).
Correlation Heatmap.
Stress Test Comparison Bar Chart.
Output:
strategies/{StrategyID}/portfolio_evaluation/ directory.
portfolio_summary.json
portfolio_metrics.csv
portfolio_overview.md
PNG charts.
2. Execution
Run python tools/portfolio_evaluator.py --strategy IDX22.
Verify outputs.
3. Deliverable
Present Executive Summary from portfolio_overview.md.
Provide Recommendation (Promote/Hold/Reject).



Final Micro-Level Validation

Only three very small clarifications to lock it perfectly:

1️⃣ Clarify “Worst Single Symbol DD”

Define explicitly:

Worst Single Symbol DD = Maximum peak-to-trough percentage drawdown across individual symbol equity curves using the same $5,000 capital basis.

This prevents someone from accidentally using dollar DD.

2️⃣ Correlation Output Scope

Specify that rolling matrix output should also include:

Average rolling correlation

Maximum rolling correlation observed

Max correlation during stress periods is more important than average.

3️⃣ Recovery Efficiency Edge Case

If Max DD Duration = 0 (no drawdown):

Set Recovery Efficiency = “N/A” instead of dividing.

Small safeguard.