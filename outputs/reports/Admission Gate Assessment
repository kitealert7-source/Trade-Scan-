# Strategy Admission Gate — SOP & Engine Impact Assessment

---

## Phase 1 — SOP Impact Identification

| File | Section | Why It Must Change | Proposed Action | Level |
|:---|:---|:---|:---|:---|
| [SOP_TESTING.md](file:///c:/Users/faraw/Documents/Trade_Scan/governance/SOP/SOP_TESTING.md) | §4A "Stage-0.5 — Strategy Semantic Validation" & §4 "Provisioning Model" | Provisioning currently happens *silently* inside Preflight. SOP_TESTING authorizes creation/modification of `strategies/` during Stage-0 but never requires explicit human approval for logic-affecting changes. This is the primary document that must change. | Amend **§4 Provisioning Model** to introduce a mandatory human approval gate before any new directory creation or logic-affecting modification to `strategy.py`. | **Procedural** |
| [trade_scan_preflight_agent.md](file:///c:/Users/faraw/Documents/Trade_Scan/governance/SOP/trade_scan_preflight_agent.md) | §2 "Strategy Provisioning (MANDATORY — Directive Mode)" | Agent contract authorizes provisioning unconditionally. Must add the approval gate to the agent's execution path. | Amend provisioning block to state: provisioning proceeds only after explicit human approval when creating new strategy folders or modifying executable logic. | **Procedural** |
| [STRATEGY_PLUGIN_CONTRACT.md](file:///c:/Users/faraw/Documents/Trade_Scan/governance/SOP/STRATEGY_PLUGIN_CONTRACT.md) | (New section needed) | Contract defines the *shape* of a valid plugin but says nothing about *admission*. | Add **"Admission Rule"** section: any new plugin or logic-affecting edit requires human sign-off before pipeline execution. | **Procedural** |
| [TRADE_SCAN_DOCTRINE.md](file:///c:/Users/faraw/Documents/Trade_Scan/governance/SOP/TRADE_SCAN_DOCTRINE.md) | §4 "NON-NEGOTIABLE CONSTRAINTS" | **No change needed.** The Doctrine already states "No discretionary overrides" and "Directive text is the sole source of strategy logic." This implicitly covers the spirit of the rule. Escalating to Doctrine-level would be scope creep. | None | — |
| [trade_scan_invariants_state_gated.md](file:///c:/Users/faraw/Documents/Trade_Scan/governance/SOP/trade_scan_invariants_state_gated.md) | — | **No new invariant needed.** This rule governs *execution discipline* (when humans must approve), not *system law* (what the machine must never do). Invariants are structural machine constraints. Human approval gates are procedural. | None | — |
| [SOP_OUTPUT.md](file:///c:/Users/faraw/Documents/Trade_Scan/governance/SOP/SOP_OUTPUT.md) | — | Not affected. Governs post-execution artifacts only. | None | — |
| [SOP_RESEARCH_DEFINITION.md](file:///c:/Users/faraw/Documents/Trade_Scan/governance/SOP/SOP_RESEARCH_DEFINITION.md) | — | Not affected. Governs hypothesis YAML, not strategy plugin admission. | None | — |

**Key finding:** This is a **procedural-level** rule, not an invariant. It governs the human–agent interaction protocol during provisioning, not an absolute machine constraint. Escalating to invariant level would conflate "agent must ask for permission" with "machine must abort," which are architecturally distinct.

---

## Phase 2 — Applicability Matrix

| Trigger | Admission Gate Applies? | Rationale |
|:---|:---:|:---|
| **New `strategies/<name>/` directory created** | **Yes** | New executable code entering the governed plugin space. Always requires human sign-off. |
| **Modification to `strategy.py` affecting executable logic** (entry/exit rules, filter changes, indicator swaps, parameter values) | **Yes** | Logic-affecting changes alter trade output. Must be approved before pipeline execution. |
| **YAML directive changes alone** (symbols, dates, timeframe, broker) | **No** | Directives parameterize execution scope, not strategy logic. Already governed by existing preflight. |
| **Non-functional edits** (comments, docstrings, whitespace, formatting) | **No** | No effect on execution output. Provisioner's idempotency check should handle this naturally. |
| **`STRATEGY_SIGNATURE` block update only** (no logic change, just metadata alignment) | **No** | Signature is a metadata identity block populated deterministically from directive. Provisioner already handles this idempotently. |

---

## Phase 3 — Enforcement Method Assessment

| Method | Feasibility | Complexity | False Positive Risk | FSM Alignment | Recommendation |
|:---|:---:|:---:|:---:|:---:|:---|
| **A) Procedural enforcement** (agent must request & receive human approval before provisioning new/modified strategies) | High | Low | None | Perfect — FSM untouched | **✅ Recommended** |
| **B) Lightweight runtime guard** (preflight checks if strategy was "pre-approved" via a marker file) | Medium | Low-Medium | Low | Good — stays in Stage-0 | Viable secondary option |
| **C) Git-level diff detection** (compare `strategies/` against HEAD before execution) | Medium | Medium | Medium — triggers on non-functional changes | Moderate — adds git dependency to runtime | Not recommended for primary |
| **D) Hash comparison against last approved version** (store approved hash, compare at preflight) | High | Medium | Low | Good — deterministic | Viable for automated enforcement, but adds state to track |
| **E) No engine change required** | — | — | — | — | Applicable if purely procedural (Option A) |

### Analysis

**Option A is the correct choice.** The existing architecture already has a natural gate: the agent executing `run_pipeline.py` must follow `trade_scan_preflight_agent.md`. This contract is the enforcement surface. By documenting that provisioning of new/modified strategy logic requires explicit human approval, the gate is enforced at the agent-protocol level without touching any engine code.

Options B and D are viable as secondary hardening *if* future experience shows procedural enforcement is insufficient. They should not be implemented proactively — that would be defensive overengineering.

Option C (git diff) introduces a runtime dependency on repository state, which violates the principle that pipeline execution should be self-contained from the file system, not from version control tooling.

---

## Phase 4 — Engine Impact Table

| Engine / Component | Modification Required? | Type | Risk Level | Justification |
|:---|:---:|:---:|:---:|:---|
| `run_pipeline.py` | No | None | — | Orchestrator delegates provisioning to `preflight.py`. Gate lives in the SOP/agent-contract layer, not in pipeline code. |
| `run_stage1.py` | No | None | — | Already has Invariant 10 boundary guard. Strategy path is validated. Admission is a separate upstream concern. |
| `PipelineStateManager` | No | None | — | State machine is not involved in strategy admission. Admission occurs before FSM initialization. |
| `DirectiveStateManager` | No | None | — | Same reasoning — admission is pre-FSM. |
| `strategy_provisioner.py` | No | None | — | Provisioner is the *executor* of provisioning, not the *gatekeeper*. The gate is procedural (agent asks human). The provisioner runs only after approval is granted. |
| `preflight.py` | No | None | — | Preflight calls `provision_strategy()`. The admission gate is documented as a required human-approval step *before* the agent invokes the pipeline. Preflight itself remains unchanged. |
| `semantic_validator.py` | No | None | — | Validates post-provisioning correctness. Not an admission concern. |

**Summary: Zero engine modifications required.** This is a purely procedural/documentary rule.

---

## Phase 5 — Governance Placement Recommendation

### Recommended placement: **Pre-FSM Procedural Gate (SOP_TESTING §4 + Agent Contract)**

**Justification:**

1. **Not an Invariant.** Invariants are machine-enforceable structural laws (e.g., "FSM must not import from research/"). This rule governs the human–agent interaction ("agent must ask before provisioning"). These are categorically different.

2. **Not Stage-0 Preflight (code).** Adding an approval-check into `preflight.py` code would require tracking approval state (marker files, registry entries), inflating complexity without proportional benefit. The agent already must follow the agent contract before invoking the pipeline.

3. **SOP_TESTING §4 is the natural home.** The provisioning model is already defined there. The admission gate extends the provisioning protocol with one additional rule: *human approval required before execution when strategy artifacts are new or logic-modified.*

4. **Agent Contract is the enforcement surface.** `trade_scan_preflight_agent.md` is what agents actually follow. Adding the approval gate there makes it directly actionable.

**Model:**

```
Human Directive
      ↓
Agent identifies strategy as NEW or MODIFIED (logic-affecting)
      ↓
Agent STOPS and requests approval ← THIS IS THE GATE
      ↓
Human approves
      ↓
Agent invokes pipeline (run_pipeline.py)
      ↓
Preflight provisions strategy
      ↓
Stage-0.5 validates
      ↓
Stage-1 executes
```

The gate is *before* the pipeline, not *inside* it. This preserves FSM purity.

---

## Summary

| Deliverable | Result |
|:---|:---|
| **SOP Documents to Update** | SOP_TESTING §4, trade_scan_preflight_agent.md §2, STRATEGY_PLUGIN_CONTRACT.md (new section) |
| **Applicability Matrix** | New folders: Yes. Logic edits: Yes. YAML-only: No. Comments: No. Signature-only: No. |
| **Enforcement Method** | Option A — Procedural enforcement via agent contract |
| **Engine Impact** | Zero modifications across all components |
| **Governance Placement** | Pre-FSM procedural gate (SOP_TESTING + Agent Contract) |
| **Overall Hardening Complexity** | **LOW** — Three SOP text insertions, zero code changes |
